# Development Guide

Users and plugin developers are welcome to adapt this extension to suit their requirements or to integrate with their plugins. For any significant work, it is recommended to wait for the coming 2.1 version, which will add several action and filter hooks to make it easier to extend.

## Overview

Several aspects of this plugin are necessarily a little different to typical WordPress extensions, in order to implement a print job spooler within a WordPress site, and to generate print jobs using the printer native commands (HTML printing is not supported).

### Custom Folder Structure

This plugin will create a `star-cloudprnt` folder inside your sites `wp-content` folder. This is used to store information about each printer that connects to your site, each device status and information, and manage the pending print jobs for each device.

It is therefore essential that your WordPress sites web server has full read/write/delete access to the `wp-content` folder (this is usually a requirement for any WordPress site, to manage plugins, media library, etc.)

### Generating print jobs - order-handler.php and the $printer object

The most common reason to modify this plugin is to modify the print job design, remove unwanted information or to extend it with support for other plugins.

It is important for developers to recognise that this plugin must generate print jobs using the printer control language (either Star Line Mode, or StarPRNT, depending on model).

Print jobs are generated by the [order-handler.php](order-handler.php) code, using a job builder API defined by [cloudprnt/printer_star_line.inc.php](cloudprnt/printer_star_line.inc.php), [cloudprnt/printer_star_prnt.inc.php](cloudprnt/printer_star_prnt.inc.php) and [cloudprnt/printer_text_plain.inc.php](cloudprnt/printer_text_plain.inc.php)

Whenever a new print job is required the function `star_cloudprnt_print_order_summary()` in `order-handler.php` is called, passing in information about the target printer (such as target command set and number of text columns that can fit on the page), a temporary filename that the print job data should be written to, and the id of the order to print.

Next, the `star_cloudprnt_command_generator()` function is used to create the `$printer` object implementing the print job builder API for your target device and file. The remainder of the `order-handler.php` code is responsible for analysing the order, and calling methods on the `$printer` object to build a print job.

### Triggering Order Printing

Typically, print jobs are triggered via user configurable action hooks that are set-up by `star_cloudprnt_setup_order_handler()` that can be found in [order-handler.inc.php](order-handler.inc.php).

#### Triggering a print from your own code

In each case, these actions are handled by calling `star_cloudprnt_trigger_print($order_id)`, passing in the order id to be printed. Third party plugins can potentially call this function directly to trigger printing.

#### Triggering a print from your own code by AJAX

An AJAX action is enabled named `star_cloudprnt_reprint_action` that can be used to trigger printing without forcing a page reload. This is used by the "Print with Star CloudPRNT" button that is included in a meta-box when viewing an order from your site admin pages.
